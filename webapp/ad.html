<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>An√∫ncio</title>
  <style>
    :root{
      --bg:#050912; --text:#EAF0FF; --muted: rgba(234,240,255,.75);
      --stroke: rgba(255,255,255,.12); --accent:#7c5cff; --accent2:#2ee9a6;
      --warn:#ffcf7a;
    }
    *{box-sizing:border-box}
    body{
      margin:0; height:100vh; width:100vw; overflow:hidden;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(900px 500px at 15% 0%, rgba(124,92,255,.25), transparent 55%),
        radial-gradient(900px 500px at 85% 20%, rgba(46,233,166,.18), transparent 60%),
        linear-gradient(180deg, #060A14, var(--bg));
      color: var(--text);
      display:flex; flex-direction:column;
    }
    .top{
      padding:14px; border-bottom:1px solid rgba(255,255,255,.06);
      background: rgba(0,0,0,.25); backdrop-filter: blur(14px);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .ttl{font-weight:900;font-size:14px}
    .timer{
      padding:8px 12px; border-radius:999px; border:1px solid var(--stroke);
      background: rgba(0,0,0,.25); color: var(--muted); font-size:12px; white-space:nowrap;
    }
    .adWrap{flex:1; display:flex; align-items:center; justify-content:center; padding:14px;}
    .adBox{
      width:100%; height:100%;
      border:1px solid rgba(255,255,255,.12);
      border-radius:18px;
      background: rgba(0,0,0,.22);
      display:flex; align-items:center; justify-content:center;
      text-align:center; padding:14px;
      overflow:auto;
    }
    .bottom{
      padding:14px; border-top:1px solid rgba(255,255,255,.06);
      background: rgba(0,0,0,.25); backdrop-filter: blur(14px);
      font-size:12px; color: var(--warn); line-height:1.35;
    }
    .ok{
      display:inline-block; margin-top:10px;
      padding:10px 12px; border-radius:12px;
      background: linear-gradient(135deg,var(--accent),var(--accent2));
      color:#061018; font-weight:900;
    }
  </style>
</head>
<body>
  <div class="top">
    <div class="ttl">üì∫ An√∫ncio (na tela do Telegram)</div>
    <div class="timer" id="timer">Carregando‚Ä¶</div>
  </div>

  <div class="adWrap">
    <div class="adBox" id="adBox">
      <div>
        <div style="font-weight:900;margin-bottom:6px">Carregando an√∫ncio‚Ä¶</div>
        <div style="opacity:.75">Aguarde alguns segundos.</div>
        <div class="ok" id="status" style="display:none">‚úÖ Pr√™mio liberado, voltando‚Ä¶</div>
      </div>

      <!-- ‚úÖ COLE AQUI O SCRIPT IN-PAGE DO ADSTERRA (Banner/Social Bar/Native) -->
      <!-- Exemplo (n√£o use esse): 
      <script>atOptions = {...}</script>
      <script src="//www.highperformanceformat.com/XXXX/invoke.js"></script>
      -->
    </div>
  </div>

  <div class="bottom">
    ‚ö†Ô∏è Direct Link/Pop abre fora no Telegram. Use Banner/Social Bar/Native para renderizar aqui dentro.
  </div>

  <script>
    const params = new URLSearchParams(location.search);
    const tg_id = params.get("tg_id") || "";
    const nonce = params.get("nonce") || "";
    const min = Math.max(8, Number(params.get("min") || 15));

    const timerEl = document.getElementById("timer");
    const statusEl = document.getElementById("status");

    // Conta regressiva e claim autom√°tico
    let left = min;
    timerEl.textContent = `Aguarde ${left}s‚Ä¶`;

    const t = setInterval(async () => {
      left--;
      if (left <= 0) {
        clearInterval(t);
        timerEl.textContent = "Finalizando‚Ä¶";

        const r = await fetch("/api/ad/claim", {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({ tg_id, nonce })
        }).then(x => x.json()).catch(() => ({ ok:false, error:"network" }));

        if (!r.ok) {
          timerEl.textContent = "Falhou. Volte e tente de novo.";
          alert("N√£o liberou: " + (r.error || "erro"));
          return;
        }

        statusEl.style.display = "inline-block";
        timerEl.textContent = "Pr√™mio liberado ‚úÖ";
        setTimeout(() => {
          location.href = `/webapp/index.html?tg_id=${encodeURIComponent(tg_id)}`;
        }, 900);
        return;
      }
      timerEl.textContent = `Aguarde ${left}s‚Ä¶`;
    }, 1000);
  </script>
</body>
</html>
